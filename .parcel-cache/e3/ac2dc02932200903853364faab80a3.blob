var helpers = require("../../../../../AppData/Roaming/npm/node_modules/parcel/node_modules/@parcel/transformer-react-refresh-wrap/lib/helpers/helpers.js");
var prevRefreshReg = window.$RefreshReg$;
var prevRefreshSig = window.$RefreshSig$;
helpers.prelude(module);
try {
  var _parcelHelpers = require("@parcel/transformer-js/lib/esmodule-helpers.js");
  _parcelHelpers.defineInteropFlag(exports);
  _parcelHelpers.export(exports, "MainView", function () {
    return MainView;
  });
  var _react = require('react');
  var _reactDefault = _parcelHelpers.interopDefault(_react);
  require('prop-types');
  var _reactRouterDom = require('react-router-dom');
  var _reactBootstrap = require('react-bootstrap');
  var _axios = require('axios');
  var _axiosDefault = _parcelHelpers.interopDefault(_axios);
  var _registrationViewRegistrationView = require('../registration-view/registration-view');
  var _loginViewLoginView = require('../login-view/login-view');
  var _movieCardsMovieCards = require('../movie-cards/movie-cards');
  var _movieInfoViewMovieInfoView = require('../movie-info-view/movie-info-view');
  var _directorViewDirectorView = require('../director-view/director-view');
  var _genreViewGenreView = require('../genre-view/genre-view');
  var _profileViewProfileView = require('../profile-view/profile-view');
  var _updateProfileUpdateProfile = require('../update-profile/update-profile');
  require('./main-view.scss');
  var _jsxFileName = "C:\\Users\\jenny\\git_projects\\myFlix-client\\src\\components\\main-view\\main-view.jsx";
  class MainView extends _reactDefault.default.Component {
    /*the export keyword exposes the MainView component, and the rest of the line creates the MainView component, extends from React.Component*/
    constructor() {
      /*where you initialize a state's values*/
      super();
      /*means call the constructor of the parent class(React.Component) ...  initializes your component’s state, and without it, you’ll get an error if you try to use this.state inside constructor()*/
      // prettier-ignore
      this.state = {
        /*represents the moment a component is created in the memory*/
        movies: [],
        users: [],
        selectedMovie: null,
        user: null,
        newUser: null,
        requestType: null
      };
    }
    componentDidMount() {
      // this happens every time the user loads the page
      // code executed right after component is added to the DOM
      let accessToken = localStorage.getItem('token');
      if (accessToken !== null) {
        // if the access token is present it means the user is already logged in
        this.setState({
          user: localStorage.getItem('user')
        });
        this.getMovies(accessToken);
        // only if the user is logged in you make the getMovies request
        this.getUsers(accessToken);
        console.log('this.state componentDidMount()', this.state);
      }
    }
    /*When a movie is clicked, this function is invoked and updates the state of the `selectedMovie` *property to that movie*/
    setSelectedMovie(newSelectedMovie) {
      this.setState({
        selectedMovie: newSelectedMovie
      });
      console.log('this.state after setSelectedMovie ', this.state);
    }
    /*When a user successfully logs in, this function updates the `user` property in state to that *particular user*/
    onLoggedIn(authData) {
      // This happens the moment the user logs in
      // This updates the state with the logged in authData
      console.log('-----------------------inside onLoggedIn MAIN-VIEW', '....authUser = ', authData);
      this.setState({
        user: authData.user.Username
      });
      localStorage.setItem('token', authData.token);
      // store token and username in localStorage: a way to store data in client's browser. Next time the user opens their browser, localStorage will contain stored authentication information (token and username), and the user won’t be required to log in again
      localStorage.setItem('user', authData.user.Username);
      this.getMovies(authData.token);
      this.getUsers(authData.token);
    }
    onRegisterNewUser(newUser) {
      this.setState({
        newUser
      });
      console.log('this.state after OnRegistetrNewUser=', this.state);
    }
    onLoggedOut() {
      console.log('this.state after onLoggedOut=', this.state);
      console.log('-----------------------inside onLoggedOut');
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      this.setState({
        user: null,
        newUser: null
      });
    }
    getMovies(token) {
      _axiosDefault.default.get('https://jennysflix.herokuapp.com/movies', {
        headers: {
          Authorization: `Bearer ${token}`
        }
      }).then(response => {
        // Assign the result to the state
        this.setState({
          movies: response.data
        });
      }).catch(function (error) {
        console.log(error);
      });
    }
    getUsers(token) {
      _axiosDefault.default.get('https://jennysflix.herokuapp.com/users', {
        headers: {
          Authorization: `Bearer ${token}`
        }
      }).then(response => {
        // Assign the result to the state
        this.setState({
          users: response.data
        });
        console.log('this.state after getUsers', this.state);
      }).catch(function (error) {
        console.log('error in get users axios request: ', error);
      });
    }
    setRequestType(type) {
      console.log('HERE IN SETREQUESTTYPE this.state BEFORE', this.state);
      console.log('-----------------------inside setRequestType type= ', type);
      this.setState({
        requestType: type
      });
      console.log('-----------------------AFTER=', type);
    }
    render() {
      const {movies, users, user, newUser, requestType} = this.state;
      console.log('user , new user = ', user, ', ', newUser);
      return (
        /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Container, {
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 142,
            columnNumber: 7
          }
        }, /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.BrowserRouter, {
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 145,
            columnNumber: 9
          }
        }, /*#__PURE__*/_reactDefault.default.createElement("span", {
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 146,
            columnNumber: 11
          }
        }, /*#__PURE__*/_reactDefault.default.createElement("h1", {
          className: "title",
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 147,
            columnNumber: 13
          }
        }, "MyFlix")), /*#__PURE__*/_reactDefault.default.createElement("span", {
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 149,
            columnNumber: 11
          }
        }, /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Link, {
          to: `/`,
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 150,
            columnNumber: 13
          }
        }, /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Button, {
          variant: "secondary",
          type: "button",
          onClick: () => this.onLoggedOut(),
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 151,
            columnNumber: 15
          }
        }, "Log Out")), /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Link, {
          to: `/users/${user}`,
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 155,
            columnNumber: 13
          }
        }, /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Button, {
          variant: "link",
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 156,
            columnNumber: 15
          }
        }, "Profile"))), /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Row, {
          className: "main-view justify-content-md-center",
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 159,
            columnNumber: 11
          }
        }, /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Route, {
          exact: true,
          path: "/",
          render: () => {
            if (!user) {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_loginViewLoginView.LoginView, {
                  onLoggedIn: user => this.onLoggedIn(user),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 165,
                    columnNumber: 26
                  }
                })
              );
            }
            if (movies.length === 0) return (
              /*#__PURE__*/_reactDefault.default.createElement("div", {
                className: "main-view",
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 167,
                  columnNumber: 49
                }
              })
            );
            return movies.map(m => /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Col, {
              md: 3,
              key: m._id,
              __self: this,
              __source: {
                fileName: _jsxFileName,
                lineNumber: 169,
                columnNumber: 19
              }
            }, /*#__PURE__*/_reactDefault.default.createElement(_movieCardsMovieCards.MovieCards, {
              movieData: m,
              __self: this,
              __source: {
                fileName: _jsxFileName,
                lineNumber: 170,
                columnNumber: 21
              }
            })));
          },
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 160,
            columnNumber: 13
          }
        }), /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Route, {
          exact: true,
          path: "/users",
          render: ({history}) => {
            if (user) return (
              /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Redirect, {
                to: "/",
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 180,
                  columnNumber: 34
                }
              })
            );
            return (
              /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Col, {
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 182,
                  columnNumber: 19
                }
              }, /*#__PURE__*/_reactDefault.default.createElement(_registrationViewRegistrationView.RegistrationView, {
                onBackClick: () => history.goBack(),
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 183,
                  columnNumber: 21
                }
              }))
            );
          },
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 176,
            columnNumber: 13
          }
        }), /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Route, {
          path: "/users/:username",
          render: ({match, history}) => {
            if (users.length === 0 || movies.length === 0) return (
              /*#__PURE__*/_reactDefault.default.createElement("div", {
                className: "main-view",
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 192,
                  columnNumber: 71
                }
              })
            );
            if (!user) {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_loginViewLoginView.LoginView, {
                  onLoggedIn: user => this.onLoggedIn(user),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 194,
                    columnNumber: 26
                  }
                })
              );
            }
            if (requestType === 'put') {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_updateProfileUpdateProfile.UpdateProfile, {
                  setRequestType: type => this.setRequestType(type),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 197,
                    columnNumber: 26
                  }
                })
              );
            }
            if (requestType === null) {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Col, {
                  md: 10,
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 201,
                    columnNumber: 21
                  }
                }, /*#__PURE__*/_reactDefault.default.createElement(_profileViewProfileView.ProfileView, {
                  userData: users.find(u => u.user === match.params.name),
                  onBackClick: () => history.goBack(),
                  setRequestType: type => this.setRequestType(type),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 202,
                    columnNumber: 23
                  }
                }))
              );
            }
          },
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 189,
            columnNumber: 13
          }
        }), /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Route, {
          path: "/movies/:movieId",
          render: ({match, history}) => {
            if (!user) {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_loginViewLoginView.LoginView, {
                  onLoggedIn: user => this.onLoggedIn(user),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 217,
                    columnNumber: 26
                  }
                })
              );
            }
            if (movies.length === 0) return (
              /*#__PURE__*/_reactDefault.default.createElement("div", {
                className: "main-view",
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 219,
                  columnNumber: 49
                }
              })
            );
            return (
              /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Col, {
                md: 8,
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 221,
                  columnNumber: 19
                }
              }, /*#__PURE__*/_reactDefault.default.createElement(_movieInfoViewMovieInfoView.MovieInfoView, {
                movieData: movies.find(movie => movie._id === match.params.movieId),
                onBackClick: () => history.goBack(),
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 222,
                  columnNumber: 21
                }
              }))
            );
          },
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 213,
            columnNumber: 13
          }
        }), /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Route, {
          path: "/directors/:name",
          render: ({match, history}) => {
            if (!user) {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_loginViewLoginView.LoginView, {
                  onLoggedIn: user => this.onLoggedIn(user),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 234,
                    columnNumber: 26
                  }
                })
              );
            }
            if (movies.length === 0) return (
              /*#__PURE__*/_reactDefault.default.createElement("div", {
                className: "main-view",
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 236,
                  columnNumber: 49
                }
              })
            );
            return (
              /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Col, {
                md: 8,
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 238,
                  columnNumber: 19
                }
              }, /*#__PURE__*/_reactDefault.default.createElement(_directorViewDirectorView.DirectorView, {
                directorData: movies.find(movie => movie.Director.Name === match.params.name).Director,
                onBackClick: () => history.goBack(),
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 239,
                  columnNumber: 21
                }
              }))
            );
          },
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 230,
            columnNumber: 13
          }
        }), /*#__PURE__*/_reactDefault.default.createElement(_reactRouterDom.Route, {
          path: "/genres/:name",
          render: ({match, history}) => {
            if (!user) {
              return (
                /*#__PURE__*/_reactDefault.default.createElement(_loginViewLoginView.LoginView, {
                  onLoggedIn: user => this.onLoggedIn(user),
                  __self: this,
                  __source: {
                    fileName: _jsxFileName,
                    lineNumber: 251,
                    columnNumber: 26
                  }
                })
              );
            }
            if (movies.length === 0) return (
              /*#__PURE__*/_reactDefault.default.createElement("div", {
                className: "main-view",
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 253,
                  columnNumber: 49
                }
              })
            );
            // make sure movies are available before rendering anything.
            return (
              /*#__PURE__*/_reactDefault.default.createElement(_reactBootstrap.Col, {
                md: 8,
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 255,
                  columnNumber: 19
                }
              }, /*#__PURE__*/_reactDefault.default.createElement(_genreViewGenreView.GenreView, {
                genreData: movies.find(movie => movie.Genre.Name === match.params.name).Genre,
                onBackClick: () => history.goBack(),
                __self: this,
                __source: {
                  fileName: _jsxFileName,
                  lineNumber: 256,
                  columnNumber: 21
                }
              }))
            );
          },
          __self: this,
          __source: {
            fileName: _jsxFileName,
            lineNumber: 247,
            columnNumber: 13
          }
        }))))
      );
    }
  }
  exports.default = MainView;
  helpers.postlude(module);
} finally {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
